/*! BP-Reactions - v1.0.1 - 2016-06-09 4:03:58 PM UTC - https://github.com/imath/bp-reactions/ */
window.bp=window.bp||{},function(a,b){"undefined"!=typeof BP_Reactions&&(bp.react={start:function(){b("#buddypress .activity").on("click",".activity-list .activity-meta .button.react",this.appendReactions),b("#buddypress .activity").on("click",".activity-list .activity-reactions a",this.saveReaction)},ajax:function(a,c){return this.ajax_request&&this.ajax_request.abort(),b.extend(a,{nonce:BP_Reactions.nonces[c]}),this.ajax_request=b.post(BP_Reactions.ajaxurl,a,"json"),this.ajax_request},warning:function(a,c,d){var e=b("<div></div>").html("<p>"+String.fromCodePoint("0x1F631")+" "+a+"</p>").addClass(c).prop("id","message");d.append(e),e.fadeOut(4e3,function(){b(this).remove()})},appendReactions:function(a){if(a.preventDefault(),BP_Reactions.is_user_logged_in){var c=b(a.currentTarget).data("bp-activity-id"),d=b("li#activity-"+c).find(".activity-reactions");if(b(a.currentTarget).hasClass("open"))return b(a.currentTarget).removeClass("open"),void d.removeClass("active");if(b(a.currentTarget).addClass("open"),0!==d.html().length)return void d.addClass("active");var e={action:"bp_activity_reactions_fetch",activity_id:c};bp.react.ajax(e,"fetch").done(function(a){return d.addClass("active"),!1===a.success?void bp.react.warning(a.data.message,"error",d):void b.each(a.data,function(a,c){var e="";c.reacted&&(e="reacted"),d.append(b("<a></a>").html(String.fromCodePoint(c.emoji)+"<span>"+c.count+"</span>").addClass(e).attr("data-bp-reaction-id",a).prop("title",BP_Reactions.reaction_labels[a]))})})}},saveReaction:function(a){a.preventDefault();var c,d,e=b(a.currentTarget),f=b.parseHTML(b(a.currentTarget).html()),g=e.closest("li").find(".react"),h=b.parseHTML(g.html()),i="",j="",k={action:"bp_activity_reactions_save",activity_id:g.data("bp-activity-id"),doaction:e.hasClass("reacted")?"remove":"add",reaction:e.data("bp-reaction-id")};bp.react.ajax(k,"save").done(function(a){if(!1===a.success)return void bp.react.warning(a.data.message,"error",e.parent());var l=1;"remove"===k.doaction?(l=-1,e.removeClass("reacted")):e.addClass("reacted"),b.each(f,function(a,b){"SPAN"===b.nodeName&&(c="<span>"+b.innerHTML+"</span>",i="<span>"+Number(parseInt(b.innerHTML,10)+l)+"</span>")}),""!==i&&e.html(e.html().replace(c,i)),b.each(h,function(a,b){"SPAN"===b.nodeName&&(d="<span>"+b.innerHTML+"</span>",j="<span>"+Number(parseInt(b.innerHTML,10)+l)+"</span>")}),""!==j&&g.html(g.html().replace(d,j)),"undefined"!=typeof BP_Reactions.user_scope&&b("#activity-"+BP_Reactions.user_scope+"-personal-li").length&&b("#activity-"+BP_Reactions.user_scope+"-personal-li").hasClass("selected")&&("reactions"===BP_Reactions.user_scope&&!e.parent().find(".reacted").length||BP_Reactions.user_scope===k.reaction)&&e.closest("li").remove(),b("#activity-popular").length&&b("#activity-popular").hasClass("selected")&&"<span>0</span>"===j&&e.closest("li").remove()})}},b(".bp-suggestions").atwho({at:":",tpl:'<li data-value="${id}">${name} <span class="bp-reactions-emoji">${id}</span></li>',data:b.map(BP_Reactions.emojis,function(a){return{name:a.name,id:String.fromCodePoint(a.id)}}),limit:10}),bp.react.start())}(bp,jQuery);